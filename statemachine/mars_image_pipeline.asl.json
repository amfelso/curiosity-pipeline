{
    "StartAt": "FetchNASAImages",
    "States": {
      "FetchNASAImages": {
        "Type": "Task",
        "Resource": "arn:aws:lambda:region:account-id:function:FetchNASAImages",
        "Next": "ProcessImages"
      },
      "ProcessImages": {
        "Type": "Map",
        "Iterator": {
          "StartAt": "ProcessImageMetadata",
          "States": {
            "ProcessImageMetadata": {
              "Type": "Task",
              "Resource": "arn:aws:lambda:region:account-id:function:ProcessImageMetadata",
              "Next": "StoreMetadataInS3"
            },
            "StoreMetadataInS3": {
              "Type": "Task",
              "Resource": "arn:aws:lambda:region:account-id:function:StoreMetadataInS3",
              "Next": "GenerateEmbedding"
            },
            "GenerateEmbedding": {
              "Type": "Task",
              "Resource": "arn:aws:lambda:region:account-id:function:GenerateEmbedding",
              "Next": "InsertIntoPinecone"
            },
            "InsertIntoPinecone": {
              "Type": "Task",
              "Resource": "arn:aws:lambda:region:account-id:function:InsertIntoPinecone",
              "Next": "LogSuccess"
            },
            "LogSuccess": {
              "Type": "Pass",
              "Next": "End"
            }
          }
        },
        "Catch": [
          {
            "ErrorEquals": ["States.ALL"],
            "ResultPath": "$.error",
            "Next": "NotifyOnFailure"
          }
        ],
        "Next": "End"
      },
      "NotifyOnFailure": {
        "Type": "Task",
        "Resource": "arn:aws:lambda:region:account-id:function:NotifyOnFailure",
        "End": true
      },
      "End": {
        "Type": "Succeed"
      }
    }
  }